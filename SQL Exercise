/* Using this dataset, show the SQL query to find the rolling 3 day average transaction amount for each day in January 2021. */

WITH A AS 
(SELECT 
 	CAST(TRANSACTION_TIME as DATE) AS TRANSACTION_DATE,
 	TRANSACTION_AMOUNT 
 FROM 
 TRANSACTIONS
),

B AS (
SELECT 
  TRANSACTION_DATE,
  SUM(TRANSACTION_AMOUNT) AS TRANSACTION_AMOUNT
FROM 
  A
WHERE
  TRANSACTION_DATE BETWEEN '2021-01-01' AND '2021-01-31'
GROUP BY TRANSACTION_DATE
),

C AS (
SELECT 
	TRANSACTION_DATE,
	AVG(TRANSACTION_AMOUNT) OVER (
      ORDER BY TRANSACTION_DATE ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ) AS THREE__DAY_ROLL_AVG
FROM 
	B
ORDER BY TRANSACTION_DATE ASC
)

SELECT THREE__DAY_ROLL_AVG FROM C
WHERE TRANSACTION_DATE = '2021-01-31';
